<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../aws-cloudwatch/aws-cloudwatch.html">
<link rel="import" href="../google-chart/google-chart.html">


<polymer-element name="aws-counts"
                 attributes="config namespace metricname startTime endTime titleText">
  <template>
      <style>
        google-chart {
          height: 120px;
          width: 100%;
        }
      </style>

      <aws-cloudwatch config="{{config}}"
                      namespace="{{namespace}}"
                      metricname="{{metricname}}"
                      starttime="{{startTime}}"
                      endtime="{{endTime}}"
                      resolution="60"
                      statistics="sum"
                      sink="{{countData}}">
      </aws-cloudwatch>

      <google-chart type="column"
                    options="{{chartOptions}}"
                    cols='{{ [{"label": "Time", "type": "datetime"}, {"label": titleText, "type": "number"}] }}'
                    rows="{{countData.sum}}">
      </google-chart>
  </template>

  <script>
    // Note: this really could be inline in the template, but {{ expr }}
    // don't support newlines so the options become unreadable...
    Polymer('aws-counts', {
      observe: {
        'startTime': 'ready',
        'endTime': 'ready',
      },
      ready: function() {
        this.chartOptions = {
          "title": titleText,
          "vAxes": [{ "viewWindow": { min: 0 } }],
          "series": [{"visibleInLegend": false}],
          "hAxis": { "viewWindow": {"min": this.startTime, "max": this.endTime}}
        };
      }
    });
  </script>
</polymer-element>
